<!DOCTYPE html>
<html>
<head>
<script>
   let myScore = 10;
   let myShooting = false;
   let enemiesKilled = 0;
   let totalEnemies = 7;
   let hasKey = false;
   let playerDir = 'd';

   setInterval(function() {
      let p = document.getElementById('myImg01');
      let px = parseInt(p.style.left);
      let py = parseInt(p.style.top);

      for(let i=2; i<=8; i++){
         let enemy = document.getElementById('myImg0' + i);
         if(enemy && enemy.style.display !== 'none'){
            let ex = parseInt(enemy.style.left);
            let ey = parseInt(enemy.style.top);

            
            if (ex < px) {
               enemy.style.left = (ex + 1) + 'px';
               enemy.style.transform = 'scaleX(1)'; 
            } else {
               enemy.style.left = (ex - 1) + 'px';
               enemy.style.transform = 'scaleX(-1)'; 
            }

            if (ey < py) enemy.style.top = (ey + 1) + 'px';
            else enemy.style.top = (ey - 1) + 'px';
         }
      }
      myCheckHit();
   }, 30);

   function myHitOther(my1, my2){
      let obj1 = document.getElementById(my1);
      let obj2 = document.getElementById(my2);
      if (!obj1 || !obj2 || obj1.style.display == 'none' || obj2.style.display == 'none') return false;

      let left1 = parseInt(obj1.style.left), right1 = left1 + parseInt(obj1.style.width);
      let top1 = parseInt(obj1.style.top), bottom1 = top1 + parseInt(obj1.style.height);
      let left2 = parseInt(obj2.style.left), right2 = left2 + parseInt(obj2.style.width);
      let top2 = parseInt(obj2.style.top), bottom2 = top2 + parseInt(obj2.style.height);
      
      return (right1 >= left2 && bottom1 >= top2 && left1 <= right2 && top1 <= bottom2);
   }

   function myCheckHit(){
      document.getElementById('myText01').value = 'Score: ' + myScore + ' | Killed: ' + enemiesKilled + '/' + totalEnemies;

      for(let i=2; i<=8; i++){
         let enemyId = 'myImg0' + i;
         if (myHitOther('myImg01', enemyId)){
            document.getElementById('myImg01').style.left = '20px';
            myScore -= 1;
         }
         if (myHitOther('myBullet01', enemyId)){
            document.getElementById(enemyId).style.display = 'none';
            document.getElementById('myBullet01').style.left = '-200px'; 
            enemiesKilled++;
            myScore += 5;
         }
      }

      if (myHitOther('myImg01','myKey')){
         document.getElementById('myKey').style.display = 'none';
         hasKey = true;
      }

      if (enemiesKilled >= totalEnemies && hasKey){
         document.getElementById('myImgDoor').style.backgroundColor = 'green';
      }

      if (myHitOther('myImg01','myImgDoor') && enemiesKilled >= totalEnemies && hasKey){
         alert("You Win!");
         location.reload(); 
      }

      if (myScore <= 0) location.reload();
   }

   function myShoot(){
       if (myShooting) return;
       myShooting = true;
       
       let bullet = document.getElementById('myBullet01');
       let player = document.getElementById('myImg01');
       let bDir = playerDir;
       
       bullet.style.left = player.style.left;
       bullet.style.top = player.style.top;
       
       let moveBullet = setInterval(function(){
           let bx = parseInt(bullet.style.left);
           let by = parseInt(bullet.style.top);

           if(bDir == 'd') bullet.style.left = (bx + 15) + 'px';
           if(bDir == 'a') bullet.style.left = (bx - 15) + 'px';
           if(bDir == 'w') bullet.style.top  = (by - 15) + 'px';
           if(bDir == 's') bullet.style.top  = (by + 15) + 'px';

           if (bx > 2000 || bx < -100 || by > 2000 || by < -100) {
               clearInterval(moveBullet);
               myShooting = false;
               bullet.style.left = '-200px';
           }
       }, 20);
   }
</script>
</head>

<body id="myBody" style="margin:0; background-color: lightgrey; overflow: hidden;" 
onkeydown="{
   let key = event.key.toLowerCase();
   let p = document.getElementById('myImg01');
   let topPos = parseInt(p.style.top);
   let leftPos = parseInt(p.style.left);
   
   if (key == 'w') { p.style.top = (topPos - 15) + 'px'; playerDir = 'w'; }
   if (key == 'a') { p.style.left = (leftPos - 15) + 'px'; playerDir = 'a'; p.style.transform = 'scaleX(-1)'; }
   if (key == 's') { p.style.top = (topPos + 15) + 'px'; playerDir = 's'; }
   if (key == 'd') { p.style.left = (leftPos + 15) + 'px'; playerDir = 'd'; p.style.transform = 'scaleX(1)'; }
   if (key == ' ') myShoot();
}">

<h1 align=center>T4A06 Game by John</h1>
<div align=center>
   <input id="myText01" type=text value="" size=40 readonly style="border:none; text-align:center; font-weight:bold;">
   <p>Defeat the Freds and grab the Massive Key!</p>
</div>

<img id="myImg01" src="assets/charater.png" style="position:absolute; width:80px; height:80px; left:50px; top:200px;">

<img id="myImg02" src="assets/fred.png" style="position:absolute; width:80px; height:80px; left:400px; top:150px;">
<img id="myImg03" src="assets/fred.png" style="position:absolute; width:80px; height:80px; left:600px; top:300px;">
<img id="myImg04" src="assets/fred.png" style="position:absolute; width:80px; height:80px; left:300px; top:400px;">
<img id="myImg05" src="assets/fred.png" style="position:absolute; width:80px; height:80px; left:750px; top:100px;">
<img id="myImg06" src="assets/fred.png" style="position:absolute; width:80px; height:80px; left:500px; top:50px;">
<img id="myImg07" src="assets/fred.png" style="position:absolute; width:80px; height:80px; left:900px; top:450px;">
<img id="myImg08" src="assets/fred.png" style="position:absolute; width:80px; height:80px; left:200px; top:100px;">

<img id="myKey" src="assets/wall textures-5.png" style="position:absolute; width:100px; height:100px; left:950px; top:500px;">

<div id="myImgDoor" style="position:absolute; width:100px; height:120px; left:1250px; top:250px; background-color:red; border:2px solid black; text-align:center; line-height:120px; font-weight:bold; color:white;">EXIT</div>

<img id="myBullet01" src="assets/charater.png" style="position:absolute; width:15px; height:15px; left: -200px; top: 0px;">

</body>
</html>
