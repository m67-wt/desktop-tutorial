<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
/* ================= CANVAS ================= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* ================= MAP ================= */
const TILE = 64;
const map = [
  [4,4,4,4,4,4,4,4,4,4,4,4],
  [4,0,0,0,0,0,0,0,0,0,0,4],
  [4,0,1,1,1,0,2,2,0,0,0,4],
  [4,0,0,0,1,0,0,0,0,3,0,4],
  [4,0,3,0,1,0,4,0,0,3,0,4],
  [4,0,0,0,0,0,4,0,0,0,0,4],
  [4,4,4,4,4,4,4,4,4,4,4,4],
];

/* ================= TEXTURES ================= */
const TEXTURE_SIZE = 100;

function loadTexture(src) {
  const img = new Image();
  img.src = src;
  // This helper will tell you in the F12 console if the path is still wrong
  img.onerror = () => console.error("Could not find image at: " + src);
  return img;
}

const wallTextures = [
  null,
 loadTexture("assets/wall textures-1.png")
  loadTexture("public/maze game/assets/wall textures-2.png"),
  loadTexture("public/maze game/assets/wall textures-3.png"),
  loadTexture("public/maze game/assets/wall textures-4.png")
];

/* ================= PLAYER ================= */
const player = {
  x: TILE * 1.5,
  y: TILE * 1.5,
  angle: 0,
  move: 1.5,
  rot: 0.04
};

/* ================= INPUT ================= */
const keys = {};
window.onkeydown = e => keys[e.key.toLowerCase()] = true;
window.onkeyup = e => keys[e.key.toLowerCase()] = false;

/* ================= COLLISION ================= */
function empty(x, y) {
  const mx = Math.floor(x / TILE);
  const my = Math.floor(y / TILE);
  return map[my] && map[my][mx] === 0;
}

/* ================= UPDATE ================= */
function update() {
  let nx = player.x;
  let ny = player.y;

  if (keys["w"]) {
    nx += Math.cos(player.angle) * player.move;
    ny += Math.sin(player.angle) * player.move;
  }
  if (keys["s"]) {
    nx -= Math.cos(player.angle) * player.move;
    ny -= Math.sin(player.angle) * player.move;
  }
  if (keys["a"]) player.angle -= player.rot;
  if (keys["d"]) player.angle += player.rot;

  if (empty(nx, player.y)) player.x = nx;
  if (empty(player.x, ny)) player.y = ny;
}

/* ================= RAYCAST ================= */

function drawWalls() {
  const fov = Math.PI / 3;

  for (let x = 0; x < canvas.width; x++) {
    const rayAngle = player.angle - fov / 2 + (x / canvas.width) * fov;
    const rayCos = Math.cos(rayAngle);
    const raySin = Math.sin(rayAngle);

    let rx = player.x;
    let ry = player.y;
    let dist = 0;
    let wallId = 0;

    // Ray stepping
    while (dist < 800) {
      rx += rayCos;
      ry += raySin;
      dist++;

      const mx = Math.floor(rx / TILE);
      const my = Math.floor(ry / TILE);

      if (map[my] && map[my][mx] > 0) {
        wallId = map[my][mx];
        break;
      }
    }

    if (wallId > 0) {
      const correctedDist = dist * Math.cos(rayAngle - player.angle);
      const wallHeight = (TILE * canvas.height) / correctedDist;
      const yPos = (canvas.height / 2) - (wallHeight / 2);

      // Texture calculation
      const hitX = (Math.abs(rx % TILE) > Math.abs(ry % TILE)) ? ry % TILE : rx % TILE;
      const texX = Math.floor((hitX / TILE) * TEXTURE_SIZE);
      const texture = wallTextures[wallId];

      // Draw texture if ready, else draw gray wall
      if (texture && texture.complete && texture.width > 0) {
        ctx.drawImage(texture, texX, 0, 1, TEXTURE_SIZE, x, yPos, 1, wallHeight);
      } else {
        ctx.fillStyle = "#666";
        ctx.fillRect(x, yPos, 1, wallHeight);
      }

      // Depth shading (darkens further walls)
      ctx.fillStyle = `rgba(0,0,0,${Math.min(0.7, correctedDist / 700)})`;
      ctx.fillRect(x, yPos, 1, wallHeight);
    }
  }
}

/* ================= LOOP ================= */
function loop() {
  update();
  
  // Clear screen & Draw Ceiling/Floor
  ctx.fillStyle = "#222"; // Ceiling
  ctx.fillRect(0, 0, canvas.width, canvas.height / 2);
  ctx.fillStyle = "#444"; // Floor
  ctx.fillRect(0, canvas.height / 2, canvas.width, canvas.height / 2);

  drawWalls();
  requestAnimationFrame(loop);
}

// Start immediately
loop();
</script>







